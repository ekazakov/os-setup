---
- name: Clonne dotfiles repository
  ansible.builtin.git:
    repo: git@github.com:ekazakov/dotfiles.git
    dest: "{{ ansible_env.HOME }}/dotfiles"
    update: true
    version: master

- name: Copy git global user config
  ansible.builtin.copy:
    src: "{{ ansible_env.HOME }}/dotfiles/user.gitconfig.tmpl"
    dest: "{{ ansible_env.HOME }}/.user.gitconfig"
    force: true

- name: Create a symbolic links for git
  ansible.builtin.file:
    src: "{{ ansible_env.HOME }}/dotfiles/{{ item }}"
    dest: "{{ ansible_env.HOME }}/{{ item }}"
    state: link
    force: true
  with_items:
    - .gitconfig
    - .gitignore_global

- name: Ensures "~/.config" dir exists
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/.config"
    state: directory

# setup Karabiner
- name: Remove karabiner default config directory
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/.config/karabiner"
    state: absent

- name: Create a symbolic link to config in ~/dotfiles/config/karabiner
  ansible.builtin.file:
    src: "{{ ansible_env.HOME }}/dotfiles/configs/karabiner"
    dest: "{{ ansible_env.HOME }}/.config/karabiner"
    state: link
    force: true

# setup Yabai
- name: Remove yabai default config directory
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/.config/yabai"
    state: absent

- name: Create a symbolic link to config in ~/dotfiles/config/yabai
  ansible.builtin.file:
    src: "{{ ansible_env.HOME }}/dotfiles/configs/yabai"
    dest: "{{ ansible_env.HOME }}/.config/yabai"
    state: link
    force: true

# setup SKHD
- name: Remove yabai default config directory
  ansible.builtin.file:
    path: "{{ ansible_env.HOME }}/.config/skhd"
    state: absent

- name: Create a symbolic link to config in ~/dotfiles/config/skhd
  ansible.builtin.file:
    src: "{{ ansible_env.HOME }}/dotfiles/configs/skhd"
    dest: "{{ ansible_env.HOME }}/.config/skhd"
    state: link
    force: true

# setup iTerm2
# - name: Create iterm2 config directory
#   file:
#     path: "{{ ansible_env.HOME }}/Library/Application Support/iTerm2"
#     state: directory
#     force: yes

# - name: Create a symbolic link to iterm2 DynamicProfiles directory
#   file:
#     src: "{{ ansible_env.HOME }}/dotfiles/DynamicProfiles"
#     dest: "{{ ansible_env.HOME }}/Library/Application Support/iTerm2/DynamicProfiles"
#     state: link
#     force: yes
